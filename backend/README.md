# Campus Network Backend

åŸºäº Flask çš„æ ¡å›­ç½‘ç»œç®—æ³•åç«¯ APIï¼Œå®ç°äº†å®Œæ•´çš„å›¾ç®—æ³•å¯è§†åŒ–ã€åŠ¨æ€æµé‡ä»¿çœŸå’Œé«˜æ€§èƒ½ç®—æ³•å¯¹æ¯”åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
cd backend
pip install -r requirements.txt
```

### è¿è¡ŒæœåŠ¡

```bash
python app.py
```

é»˜è®¤åœ°å€ï¼š`http://localhost:5000`

### ä¾èµ–é¡¹

- Flask 3.0.0 - Webæ¡†æ¶
- flask-cors 4.0.0 - è·¨åŸŸæ”¯æŒ
- networkx 3.2.1 - å›¾ç®—æ³•åº“
- matplotlib 3.8.2 - å›¾åƒç”Ÿæˆ
- numpy 1.26.2 - æ•°å€¼è®¡ç®—

## ğŸ“Š API æ¦‚è§ˆ

### ç½‘ç»œé…ç½® API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|------|
| `/api/network/generate` | POST | ç”Ÿæˆéšæœºç½‘ç»œæ‹“æ‰‘ | ç”Ÿæˆè¿é€šå¹³é¢å›¾ï¼Œè¿”å›Base64å›¾åƒ |
| `/api/network/config/default` | GET | è·å–é»˜è®¤é…ç½® | è¿”å›å½“å‰é»˜è®¤ç½‘ç»œå‚æ•° |
| `/api/graph/preview` | POST | ç»˜åˆ¶åŸå§‹å›¾ | æ”¯æŒå¤šç§æ ‡ç­¾æ¨¡å¼ |

### æœ€å°ç”Ÿæˆæ ‘ API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|------|
| `/api/mst/compare` | POST | å¯¹æ¯”ä¸¤ç§ç®—æ³• | åŒæ—¶è¿è¡ŒKruskalå’ŒPrimï¼Œè¿”å›æ­¥éª¤ä¸æ€§èƒ½ |

### æœ€å¤§æµ API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|------|
| `/api/maxflow/edmonds-karp` | POST | Edmonds-Karpç®—æ³• | BFSå¢å¹¿è·¯å¾„ï¼ŒO(VEÂ²) |
| `/api/maxflow/dinic` | POST | Dinicç®—æ³• | å±‚æ¬¡å›¾+DFSï¼ŒO(VÂ²E) |

### åŠ å¯† API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|------|
| `/api/aes/encrypt` | POST | AES-128åŠ å¯† | è¾“å‡ºhexæ ¼å¼å¯†æ–‡ |
| `/api/aes/decrypt` | POST | AES-128è§£å¯† | è¾“å…¥hexæ ¼å¼å¯†æ–‡ |

### äº¤äº’å¼ä»¿çœŸ API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|------|
| `/api/traffic/calculate-paths` | POST | è·¯å¾„è®¡ç®—ä¸æµé‡åˆ†é… | æ”¯æŒå¤šè·¯å¾„ã€è´Ÿè½½å‡è¡¡ã€æ‹¥å¡æ£€æµ‹ |

### å…¶ä»– API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|------|
| `/api/plots/<filename>` | GET | è·å–ç”Ÿæˆå›¾åƒ | è¿”å›é™æ€å›¾ç‰‡æ–‡ä»¶ |

## è¯¦ç»†è¯´æ˜ä¸ç¤ºä¾‹

### 1) ç”Ÿæˆç½‘ç»œæ‹“æ‰‘
```
POST /api/network/generate
Content-Type: application/json

{
  "num_nodes": 12,
  "cost_range": [1, 20],
  "capacity_range": [50, 300],
  "seed": 42
}
```
å“åº”åŒ…å«ï¼š`config`ã€`nodes`ã€`edges`ã€`topology_image`(base64) ä¸ç»Ÿè®¡ä¿¡æ¯ã€‚

### 2) é»˜è®¤ç½‘ç»œé…ç½®
```
GET /api/network/config/default
```

### 3) åŸå§‹å›¾é¢„è§ˆ
```
POST /api/graph/preview
{
  "nodes": [{"id":0,"label":"0"}, ...],
  "edges": [{"from":0,"to":1,"weight":10,"capacity":100}, ...],
  "label_mode": "auto"  // å¯é€‰
}
```
è¿”å› `visualization`(base64)ã€‚

### 4) æœ€å°ç”Ÿæˆæ ‘å¯¹æ¯”
```
POST /api/mst/compare
{
  "nodes": [...],
  "edges": [{"from":0,"to":1,"weight":10}, ...]
}
```
è¿”å› `kruskal` ä¸ `prim` ä¸¤å¥—ç»“æœï¼ˆå« steps ä¸ visualizationï¼‰ã€‚

### 5) æœ€å¤§æµï¼ˆEdmonds-Karp / Dinicï¼‰
```
POST /api/maxflow/edmonds-karp
POST /api/maxflow/dinic
{
  "nodes": [...],
  "edges": [{"from":0,"to":1,"capacity":16}, ...],
  "source": 0,
  "sink": 5
}
```
è¿”å› `max_flow`ã€`flow_edges`ã€`steps` ä¸ `visualization`ã€‚

### 6) AES åŠ å¯†/è§£å¯†ï¼ˆåå…­è¿›åˆ¶ï¼‰
```
POST /api/aes/encrypt
{
  "plaintext": "Hello World",
  "key": "my_secret_key"
}
```
å“åº”ï¼š`encrypted` ä¸º hex å­—ç¬¦ä¸²ï¼›åŒæ—¶è¿”å› `format: "hex"`ã€‚
```
POST /api/aes/decrypt
{
  "encrypted": "<hex_string>",
  "key": "my_secret_key"
}
```

### 7) è·¯å¾„ä¸æµé‡åˆ†é…ï¼ˆäº¤äº’ä»¿çœŸï¼‰
```
POST /api/traffic/calculate-paths
{
  "nodes": [...],
  "edges": [...],
  "source": 0,
  "target": 5,
  "total_flow": 1000,
  "strategy": "balanced",   // "single" | "balanced"
  "num_paths": 3
}
```
è¿”å›ï¼š
- `paths`: è·¯å¾„æ•°ç»„
- `path_allocations`: æ¯æ¡è·¯å¾„çš„ {flow, capacity, utilization}
- `total_capacity`, `requested_flow`, `actual_flow`, `is_limited`, `num_paths`

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app.py                    # Flask åº”ç”¨ä¸»å…¥å£ï¼Œè·¯ç”±å®šä¹‰ä¸è¯·æ±‚å¤„ç†
â”œâ”€â”€ requirements.txt          # Python ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ algorithms/               # æ ¸å¿ƒç®—æ³•å®ç°æ¨¡å—
â”‚   â”œâ”€â”€ mst.py               # æœ€å°ç”Ÿæˆæ ‘ (Kruskal & Prim)
â”‚   â”œâ”€â”€ maxflow.py           # æœ€å¤§æµ (Edmonds-Karp & Dinic)
â”‚   â”œâ”€â”€ aes_encrypt.py       # AES-128 å®Œæ•´å®ç°
â”‚   â”œâ”€â”€ traffic.py           # æµé‡ä»¿çœŸä¸å¤šè·¯å¾„è´Ÿè½½å‡è¡¡
â”‚   â”œâ”€â”€ generate_graph.py    # éšæœºå¹³é¢ç½‘ç»œç”Ÿæˆå™¨
â”‚   â””â”€â”€ utils.py             # å¯è§†åŒ–å·¥å…·ä¸é€šç”¨å‡½æ•°
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶æ¨¡å—
â”‚   â””â”€â”€ network_config.py    # ç½‘ç»œå‚æ•°é…ç½®ç±»ä¸é»˜è®¤é…ç½®
â””â”€â”€ static/plots/            # æœåŠ¡ç«¯ç”Ÿæˆçš„å›¾åƒæ–‡ä»¶å­˜å‚¨
```

## ğŸ’» æ ¸å¿ƒç®—æ³•å®ç°

### 1. æœ€å°ç”Ÿæˆæ ‘ (algorithms/mst.py)

**Kruskal ç®—æ³•**
- å®ç°ç­–ç•¥ï¼šè¾¹æ’åº + å¹¶æŸ¥é›† (Union-Find)
- æ—¶é—´å¤æ‚åº¦ï¼šO(E log E)
- ç‰¹ç‚¹ï¼šé€‚åˆç¨€ç–å›¾ï¼Œæ¯æ­¥é€‰æ‹©å…¨å±€æœ€å°è¾¹

**Prim ç®—æ³•**
- å®ç°ç­–ç•¥ï¼šä¼˜å…ˆé˜Ÿåˆ— + å¢é‡æ‰©å±•
- æ—¶é—´å¤æ‚åº¦ï¼šO(E log V)
- ç‰¹ç‚¹ï¼šé€‚åˆå¯†é›†å›¾ï¼Œä»å•ç‚¹é€æ­¥å¢é•¿

**å¯è§†åŒ–æ”¯æŒ**
- é€æ­¥åŠ¨ç”»ï¼šç”Ÿæˆæ¯ä¸ªé€‰è¾¹æ­¥éª¤çš„Base64å›¾åƒ
- å¸ƒå±€å›ºå®šï¼šä½¿ç”¨å›ºå®šå¸ƒå±€ç®—æ³•é¿å…èŠ‚ç‚¹æŠ–åŠ¨
- é¢œè‰²ç¼–ç ï¼šé»„è‰²(å€™é€‰)ã€ç»¿è‰²(å·²é€‰)ã€çº¢è‰²(å½“å‰)

### 2. æœ€å¤§æµ (algorithms/maxflow.py)

**Edmonds-Karp ç®—æ³•**
- æ ¸å¿ƒæ€æƒ³ï¼šBFS å¯»æ‰¾æœ€çŸ­å¢å¹¿è·¯å¾„
- æ—¶é—´å¤æ‚åº¦ï¼šO(VEÂ²)
- å®ç°ç‰¹è‰²ï¼šæ®‹é‡å›¾ + BFSé˜Ÿåˆ— + è·¯å¾„å›æº¯

**Dinic ç®—æ³•**
- æ ¸å¿ƒæ€æƒ³ï¼šåˆ†å±‚æ¬¡å›¾ + DFS é˜»å¡æµ
- æ—¶é—´å¤æ‚åº¦ï¼šO(VÂ²E)ï¼Œå•ä½ç½‘ç»œä¸‹ O(EâˆšV)
- å®ç°ç‰¹è‰²ï¼šå±‚æ¬¡å›¾ + å½“å‰å¼§ä¼˜åŒ– + å¤šè·¯å¢å¹¿

**å¯è§†åŒ–æ”¯æŒ**
- å¢å¹¿è·¯å¾„å¸§ï¼šé«˜äº®æ˜¾ç¤ºå½“å‰è·¯å¾„å’Œç“¶é¢ˆå€¼
- å±‚æ¬¡å›¾å¸§ï¼š(Dinic) å±•ç¤ºåˆ†å±‚ç»“æ„
- æµé‡å¯è§†ï¼šè¾¹å®½è¡¨ç¤ºæµé‡å¤§å°
- ç´¯ç§¯å†å²ï¼šæ˜¾ç¤ºæ‰€æœ‰å†å²è·¯å¾„

### 3. æµé‡ä»¿çœŸ (algorithms/traffic.py)

**LoadBalancer ç±»**
- å¤šè·¯å¾„æŸ¥æ‰¾ï¼šåŸºäºæƒ©ç½šæœºåˆ¶çš„ k æ¡æœ€çŸ­è·¯å¾„
- è¾¹ä¸ç›¸äº¤ç­–ç•¥ï¼šç§»é™¤å·²ç”¨è¾¹åå†æ¬¡æœç´¢
- æƒé‡æƒ©ç½šç­–ç•¥ï¼šå¯¹å·²ç”¨è¾¹å¢åŠ æƒé‡ä¿ƒè¿›å¤šæ ·åŒ–

**æ‹¥å¡æ£€æµ‹**
- é“¾è·¯åˆ©ç”¨ç‡é˜ˆå€¼ï¼š80% é˜ˆå€¼åˆ¤å®š
- 50-80%ï¼šé€‚åº¦æƒé‡æƒ©ç½š
- 80-95%ï¼šå¤§å¹…æƒé‡æƒ©ç½šï¼Œå°½é‡é¿å¼€
- >95%ï¼šæé«˜æƒ©ç½šï¼Œå‡ ä¹å®Œå…¨é¿å…

**æµé‡åˆ†é…ç­–ç•¥**
- Singleï¼šå•è·¯å¾„æ¨¡å¼ï¼Œæ‰€æœ‰æµé‡èµ°æœ€çŸ­è·¯å¾„
- Balancedï¼šè´Ÿè½½å‡è¡¡æ¨¡å¼ï¼ŒæŒ‰å®¹é‡æ¯”ä¾‹åˆ†é…
- å…±äº«è¾¹å¤„ç†ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶è°ƒæ•´å¤šè·¯å¾„æ±‡èšçš„è¾¹

### 4. AESåŠ å¯† (algorithms/aes_encrypt.py)

**AES128 ç±»**
- å®Œæ•´å®ç°ï¼šAES-128 åŠ å¯†ã€è§£å¯†ã€å¯†é’¥æ‰©å±•
- æ ¸å¿ƒæ“ä½œï¼šSubBytesã€ShiftRowsã€MixColumnsã€AddRoundKey
- æ¨¡å¼æ”¯æŒï¼šECB æ¨¡å¼ + PKCS#7 å¡«å……
- æ ¼å¼è¾“å‡ºï¼šhex ç¼–ç å­—ç¬¦ä¸²

### 5. ç½‘ç»œç”Ÿæˆ (algorithms/generate_graph.py)

**generate_random_planar_network**
- è¿é€šæ€§ä¿è¯ï¼šå…ˆæ„å»ºç”Ÿæˆæ ‘
- å¹³é¢æ€§ä¿è¯ï¼šä½¿ç”¨ NetworkX çš„ check_planarity
- å±æ€§åˆ†é…ï¼šé€ ä»·(cost)å’Œå®¹é‡(capacity)éšæœºç”Ÿæˆ
- å¸ƒå±€ç®—æ³•ï¼šæåæ ‡éšæœºå¸ƒç½® + æœ€å°é—´è·çº¦æŸ

## ğŸ¨ å¯è§†åŒ–ç³»ç»Ÿ

### å›¾åƒç”Ÿæˆæµç¨‹
1. Matplotlib æœåŠ¡ç«¯ç»˜å›¾ (Agg backend)
2. BytesIO å†…å­˜ç¼“å†²åŒºå­˜å‚¨
3. Base64 ç¼–ç ä¼ è¾“
4. å‰ç«¯ <img> æ ‡ç­¾æ˜¾ç¤º

### å¯è§†åŒ–ç‰¹æ€§
- **ä¸­æ–‡æ”¯æŒ**ï¼šè‡ªåŠ¨é…ç½®ä¸­æ–‡å­—ä½“å›é€€
- **ä¸»é¢˜ä¸€è‡´**ï¼šç»Ÿä¸€çš„è“ç´«ä¸»é¢˜é…è‰²æ–¹æ¡ˆ
- **å¸ƒå±€ç¨³å®š**ï¼šå›ºå®šå¸ƒå±€ç®—æ³•é¿å…èŠ‚ç‚¹æŠ–åŠ¨
- **é«˜æ¸…è¾“å‡º**ï¼š150 DPI é«˜åˆ†è¾¨ç‡å›¾åƒ

## ğŸ”§ å·¥å…·å‡½æ•° (algorithms/utils.py)

### æ ¸å¿ƒå‡½æ•°
- `validate_graph_data()` - å›¾æ•°æ®æ ¡éªŒ
- `compute_fixed_layout()` - å›ºå®šå¸ƒå±€è®¡ç®—
- `setup_chinese_font()` - ä¸­æ–‡å­—ä½“é…ç½®
- `draw_original_graph()` - åŸå§‹å›¾ç»˜åˆ¶
- `draw_mst_result()` - MST ç»“æœå¯è§†åŒ–
- `draw_maxflow_result()` - æœ€å¤§æµç»“æœå¯è§†åŒ–
- `draw_mst_step_visualization()` - MST æ­¥éª¤å¸§
- `draw_maxflow_step_visualization()` - æœ€å¤§æµæ­¥éª¤å¸§

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒè¦æ±‚**ï¼šPython 3.8+
2. **å†…å­˜ç®¡ç†**ï¼šå¤§å‹ç½‘ç»œå¯è§†åŒ–éœ€è¦è¾ƒå¤šå†…å­˜
3. **çº¿ç¨‹å®‰å…¨**ï¼šMatplotlib ä¸æ”¯æŒå¤šçº¿ç¨‹ï¼Œä½¿ç”¨é»˜è®¤å•çº¿ç¨‹æ¨¡å¼
4. **è·¨åŸŸé…ç½®**ï¼šFlask-CORS å·²å¯ç”¨ï¼Œå…è®¸æ‰€æœ‰æºè®¿é—®
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šç®—æ³•è®¡æ—¶ä¸å¯è§†åŒ–è®¡æ—¶åˆ†å¼€ï¼Œå‡†ç¡®è¡¡é‡ç®—æ³•æ€§èƒ½
